## Anomal-IA, herramienta para detecci√≥n de anomal√≠as para ElectroDunas

Yolanda Franco
Daniel Rozo
Jos√© Hoyos
Gabriel G√≥mez

Este proyecto trata sobre la identificaci√≥n de anomal√≠as en el consumo de energ√≠a el√©ctrica para diferentes clientes de ElectroDunas.

### Tratamiento previo de los datos: 
#### Rutina de carga de informaci√≥n: 
En una primera etapa del proceso, se estableci√≥ una estructura de almacenamiento inicial para los datos de los clientes, a trav√©s de la creaci√≥n de una carpeta designada. Esta carpeta sirve como un repositorio provisional donde se alojar√°n los archivos .csv que contienen informaci√≥n relevante sobre los consumos y comportamientos de los clientes. Se anticipa que este m√©todo de almacenamiento ser√° reemplazado por un repositorio m√°s sofisticado y din√°mico en el futuro, especialmente si se logra acceder a los datos de los clientes en tiempo real. 
 
Los datos de los clientes se organizaron y manipularon utilizando el lenguaje de programaci√≥n Python, aprovechando la potencia de las bibliotecas especializadas como Pandas. La informaci√≥n se carg√≥ en memoria como una serie de dataframes (DF). Cada DF corresponde a un archivo .csv individual, representando los datos asociados a un cliente espec√≠fico. Adem√°s de la informaci√≥n de consumo, se enriqueci√≥ cada DF agregando una columna que identifica el sector econ√≥mico al que pertenece el cliente correspondiente. 
 
As√≠, se procedi√≥ a unir la informaci√≥n proporcionada por la empresa sobre los sectores econ√≥micos de los clientes. Esto se realiz√≥ mediante la incorporaci√≥n de un archivo externo en formato Excel que contiene la clasificaci√≥n de los clientes seg√∫n sus respectivos sectores econ√≥micos. Se realizaron ajustes pertinentes en los nombres de las columnas y en el formato de los datos para asegurar una integraci√≥n sin fisuras entre los datos de los clientes y la informaci√≥n sobre sus sectores econ√≥micos. 
 
#### Descriptivos: 
Para analizar la informaci√≥n proporcionada por el cliente, llevamos a cabo varios an√°lisis descriptivos. Realizamos una evaluaci√≥n gr√°fica para examinar los patrones de comportamiento mensual de los clientes en cada sector. Sin embargo, debido a las limitaciones de espacio en este documento, nuestro an√°lisis descriptivo se centrar√° en una visi√≥n global de los datos. El objetivo de este an√°lisis es identificar patrones de consumo y familiarizarnos con la informaci√≥n proporcionada. 

En un primer an√°lisis, vamos a evaluar la correlaci√≥n de las variables Energ√≠a Activa, Reactiva y Voltaje FA y FC. Esto nos permite comprender las relaciones entre diferentes variables en un conjunto de datos, facilitando tanto la reducci√≥n de la dimensionalidad como la identificaci√≥n de anomal√≠as. Por ejemplo, si dos variables suelen estar altamente correlacionadas y observamos un punto donde una variable se desv√≠a significativamente de esta relaci√≥n habitual, esto podr√≠a indicar la presencia de una anomal√≠a.  

La correlaci√≥n entre las variables Voltaje_FA y Voltaje_FC es fuerte (0.95), lo que indica que suelen moverse juntas. Un punto donde una de estas variables se desv√≠a significativamente de esta tendencia podr√≠a indicar una anomal√≠a. Por otro lado, la correlaci√≥n moderada (0.64) entre la energ√≠a activa y la energ√≠a reactiva sugiere una relaci√≥n positiva menos fuerte. Aun as√≠, un punto donde la energ√≠a activa es alta pero la energ√≠a reactiva es baja (o viceversa) podr√≠a ser un indicador de anomal√≠a (imagen 1). 

![Imagen 1](https://github.com/ggomez1803/ElectroDunas/assets/10146054/8439316a-b445-4839-ba6b-f3bd9000a405)<br>
Imagen 1. Matriz de correlaci√≥n de variables Energ√≠a Activa ‚Äì Reactiva y Voltaje FA y FC 
 
Para obtener una visi√≥n general de la distribuci√≥n de los datos y tener alguna noci√≥n sobre las anomal√≠as, se generaron gr√°ficos de boxplot. A partir de este an√°lisis, se concluye que hay una gran heterogeneidad y datos an√≥malos en los patrones de consumo de energ√≠a el√©ctrica. Adem√°s, se observan anomal√≠as en los datos de voltaje, aunque estas son menos frecuentes en comparaci√≥n con el par energ√©tico. 

 ![Imagen 2](https://github.com/ggomez1803/ElectroDunas/assets/10146054/190b1907-fb06-4a71-9bb8-5f598e702f1b)<br>
Imagen 2. Boxplots por cliente y sector econ√≥mico 
Despu√©s de investigar y consultar expertos en la materia, experimentamos con dos conceptos que no solo definir√≠an nuestro rumbo a seguir en la detecci√≥n de anomal√≠as en nuestro sistema, sino que tambi√©n nos ayudar√≠an a reducir la dimensionalidad a solo 2 variables, explicando las 4 dadas. El factor de potencia (FP), es una medida de eficiencia en la trasferencia de energ√≠a el√©ctrica, se define como la relaci√≥n entre la energ√≠a activa y la potencia aparente. La energ√≠a activa, como sabemos, es la que se consume realmente al realizar alg√∫n trabajo √∫til, como encender una bombilla. La potencia aparente, un t√©rmino nuevo para el experimento, se puede entender como la potencia total que fluye en un circuito incluyendo energ√≠a activa y reactiva. Esta la definiremos en la siguiente f√≥rmula: 

$\ S = ‚àö{PÀÜ2} + QÀÜ2$
 
Donde: <br>
- S es la potencia aparente
- P es la energ√≠a activa.
- Q es la energ√≠a reactiva. 
 
Teniendo clara esta medici√≥n, el FP se calcula dividiendo la energ√≠a activa (P) por la potencia aparente (S). La definiremos en la siguiente f√≥rmula: 

$\ FP = P/S$

Donde: <br>
- P es la energ√≠a activa.
- S es la potencia aparente. 
 
El factor de potencia (FP) debe ser un valor entre 0 y 1. Idealmente, cuando este valor se aproxima a 1, indica que la energ√≠a se est√° utilizando de manera eficiente. Esto nos lleva a un supuesto importante: un sistema eficiente deber√≠a tener un factor de potencia cercano a este valor. Si el factor de potencia se aleja significativamente de 1, podr√≠a indicar una anomal√≠a. Esto se debe a que un factor de potencia bajo sugiere que una cantidad significativa de energ√≠a se est√° perdiendo durante el proceso de transferencia de energ√≠a. 

Por otro lado, cuando consideramos las dos variables Voltaje_FA y Voltaje_FC, podemos inferir que estamos tratando con un sistema trif√°sico (ST). Un ST es un sistema de producci√≥n, distribuci√≥n y consumo de energ√≠a el√©ctrica que utiliza tres corrientes monof√°sicas. En un sistema trif√°sico equilibrado, los voltajes FA, FB y FC deber√≠an tener magnitudes iguales y estar desfasados sim√©tricamente. Si este equilibrio no se mantiene, podemos inferir que el sistema de tensiones est√° desequilibrado.1 

Considerando que s√≥lo disponemos de los voltajes FA y FC, empleamos una f√≥rmula que proporciona una medida normalizada del principio de desequilibrio. Esta f√≥rmula consiste en dividir la diferencia absoluta entre los voltajes FA y FC por el voltaje m√°s peque√±o. De esta manera, obtenemos una medida de desequilibrio que es independiente de la magnitud de los voltajes. Este enfoque es especialmente √∫til para identificar anomal√≠as dado que, en un sistema trif√°sico equilibrado, los tres voltajes deber√≠an ser iguales. Por lo tanto, cualquier desviaci√≥n significativa de esta igualdad podr√≠a indicar un problema o anomal√≠a en el sistema. 

$\ ùê∑ùëâ= (‚à£ùëâùêπùê¥‚àíùëâùêπùê∂‚à£)/min(ùëâùêπùê¥,  ùëâùêπùê∂)$

 
Donde: <br>
- DV es el desequilibrio de voltaje normalizado.
- ùëâùêπùê¥ es la variable Voltaje_FA.
- ùëâùêπùê∂ es la variable Voltaje_FC. 
 
La obtenci√≥n del factor de potencia (FP) y el desequilibrio de voltaje (DV) nos proporciona dos variables normalizadas que nos permiten explicar tanto las energ√≠as como los voltajes en nuestro experimento de manera eficiente. 
 
En la imagen 3, se muestran las correlaciones obtenidas para las diferentes variables disponibles. Con relaci√≥n a nuestras nuevas variables, observamos una correlaci√≥n positiva entre el factor de potencia (FP) y la energ√≠a activa, lo que podr√≠a indicar que las anomal√≠as est√°n asociadas con una eficiencia energ√©tica reducida. De manera similar, las correlaciones negativas entre el desequilibrio de voltaje y los voltajes FA y FC podr√≠an indicar que las anomal√≠as est√°n asociadas con un sistema desequilibrado. 

 ![Imagen 3](https://github.com/ggomez1803/ElectroDunas/assets/10146054/4d40c53a-7da9-4c91-8467-cbb246683813)<br>
Imagen 3. Matriz de correlaci√≥n con las variables FP y DV. 

### Preprocesamiento: 
A cada uno de los dataframes (DF) pertenecientes a la lista creada previamente con la informaci√≥n de los clientes se agregaron las columnas de Factor Potencia (FP), Potencia Aparente (S) y Desequilibrio de voltaje (DV). De igual manera, se agreg√≥ la columna de fecha, se valid√≥ que no hubiera datos faltantes, que todos los DFs tuvieran el mismo n√∫mero de columnas y por √∫ltimo que la fecha estuviera en el mismo formato. Al final se consolid√≥ todo en una DF global. Ver imagen 4. 

 ![Imagen 4](https://github.com/ggomez1803/ElectroDunas/assets/10146054/cec90ae0-460f-4bbf-9594-69b64752c7d8)<br>
Imagen 4. C√≥digo preprocesamiento. 
 
Al evaluar el Factor de Potencia (FP) y el Desequilibrio de Voltaje (DV) en una distribuci√≥n de frecuencias (imagen 6), observamos que los datos tienden a concentrarse en valores con FP = 1 y DV = 0. Sin embargo, en la gr√°fica del FP, se observan datos an√≥malos, como valores negativos, y en el DV, datos extremos que alcanzan hasta 60,000. Para el tratamiento de estos valores at√≠picos, los mejores resultados se obtuvieron a trav√©s del Rango Intercuartil, considerando como at√≠picas las observaciones que se encuentran por encima de 1.5+Q3 o debajo Q1-1.5 veces este valor (imagen 5). Tambi√©n se prob√≥ la m√©trica Z-Score para tratar outliers, pero no proporcion√≥ los resultados esperados. Como se mencion√≥ anteriormente, no era conveniente imputar esta informaci√≥n al principio debido a la naturaleza del experimento de encontrar datos an√≥malos; sin embargo, dados los resultados, se tom√≥ la decisi√≥n de clasificar autom√°ticamente como anomal√≠as los outliers encontrados antes de proceder con los modelos de supervisados de clusterizaci√≥n. 

 ![Imagen 5](https://github.com/ggomez1803/ElectroDunas/assets/10146054/50783803-a71a-4fb0-9cf8-2e0274754221)<br>
Imagen 5. C√≥digo para tratar outliers usando IQR por sector. 


![Imagen 6](https://github.com/ggomez1803/ElectroDunas/assets/10146054/86d9bd3a-f538-49ac-b39b-e403bfef1729)<br>
Imagen 6. Distribuci√≥n de frecuencias Factor de potencia y desequilibrio de voltaje de toda la muestra. 
 
El tratamiento de los outliers se llev√≥ a cabo considerando el sector al que pertenece cada cliente. Esta consideraci√≥n es relevante ya que puede proporcionar una medida significativa para identificar valores extremos dentro del entorno en el que opera cada cliente. Tras este tratamiento, la distribuci√≥n de los datos mostr√≥ una notable mejora para estas variables, presentando magnitudes con un mayor sentido t√©cnico. Los detalles se pueden observar en la siguiente imagen (Imagen 7): 

![Imagen 7](https://github.com/ggomez1803/ElectroDunas/assets/10146054/0f129ffa-d451-469f-ac95-6f2fca5ba390)<br>
Imagen 7. Distribuci√≥n de frecuencias de FP y DV sin outliers. 

Para preparar los datos para un an√°lisis de clustering subsiguiente, hemos seleccionado las columnas de inter√©s espec√≠ficas: el Factor de Potencia (FP) y el Desequilibrio de Voltaje (DV). Es importante recordar nuestra hip√≥tesis de que los datos que se desv√≠an significativamente de un FP igual a 1 y un DV igual a 0 tienen una mayor probabilidad de ser considerados anomal√≠as. 
 
#### Entrenamiento de los modelos: 
El objetivo principal de esta etapa del proyecto es explorar y evaluar diversos algoritmos de clustering para segmentar los datos de consumo de energ√≠a de los clientes en dos grupos distintos: consumos normales y consumos at√≠picos. Dado que el proyecto se enfoca en el an√°lisis no supervisado, no se busca una calibraci√≥n espec√≠fica de los modelos, sino m√°s bien una evaluaci√≥n exhaustiva de su desempe√±o utilizando m√©tricas adecuadas. 
Inicialmente se consideraron varios algoritmos de clustering, entre ellos, K-Means, Birch y Spectral Clustering, cada uno con sus propias caracter√≠sticas y supuestos subyacentes sobre la estructura de los datos. Sin embargo, bas√°ndonos en el supuesto que un sistema el√©ctrico √≥ptimo tiende a que el factor de potencia (FP) sea 1 y el desequilibrio de voltaje (DV) sea 0, decidimos recurrir a probar modelos donde pudi√©ramos definir desde un principio el centroide √≥ptimo (1,0).  
Inicialmente, nos centramos en el algoritmo K-Means (KM). Este algoritmo presenta la ventaja de permitirnos definir nuestro propio centroide, adem√°s de ser f√°cil de implementar y eficiente en t√©rminos computacionales. No obstante, dada su naturaleza iterativa del proceso de minimizaci√≥n de distancias, no hay garant√≠a que los centroides permanezcan en la posici√≥n √≥ptima que buscamos. Es decir, los centroides inicializados en (1, 0) con KM pueden desplazarse durante la ejecuci√≥n del algoritmo. Tras evaluar estas limitaciones, decidimos tambi√©n explorar una estrategia alternativa basada en la clasificaci√≥n por distancia o umbrales. 
En la metodolog√≠a que empleamos basada en modelos con umbrales, calculamos la distancia euclidiana de cada punto al centroide (1, 0). Luego, clasificamos los puntos en dos grupos dependiendo de si su distancia es mayor o menor que la mediana de todas las distancias. Adem√°s, implementamos un enfoque complementario que utiliza la distancia de Mahalanobis. Este enfoque tiene en cuenta la correlaci√≥n entre las variables y la variabilidad de cada una. Bas√°ndonos en un umbral derivado del cuantil de la distribuci√≥n chi-cuadrado con un nivel de significancia del 0.01, clasificamos los puntos como anomal√≠as o normales. Esto nos proporciona un 99% de confianza en la precisi√≥n de la clasificaci√≥n. 
Durante el proceso de evaluaci√≥n, utilizamos tres m√©tricas de desempe√±o ampliamente reconocidas en el √°mbito del clustering: Silhouette score, Davies Bouldin y Calinski Harabasz. Estas m√©tricas proporcionan informaci√≥n valiosa sobre la calidad y la coherencia de los grupos generados por los algoritmos de clustering. Sin embargo, dada la naturaleza de nuestro experimento de encontrar anomal√≠as, decidimos emplear m√©tricas complementarias como la densidad, n√∫mero de datos y varianza, los cuales se profundizar√°n en la secci√≥n de an√°lisis de resultados. 
Por ejemplo, el Silhouette score, el √≠ndice de Davies-Bouldin y el √≠ndice de Calinski-Harabasz nos ayudan a medir la cohesi√≥n y separaci√≥n de los clusters, as√≠ como la dispersi√≥n dentro y entre ellos. En cuanto a la detecci√≥n de anomal√≠as, consideramos la densidad de datos, el n√∫mero de datos y la varianza dentro de un agrupamiento. Un cluster con una densidad de datos baja, un n√∫mero de datos at√≠pico o una alta varianza puede indicar la presencia de anomal√≠as. 
Dado que el proyecto tiene como objetivo final la identificaci√≥n de dos segmentos principales, es decir, consumos normales y consumos at√≠picos, se ha establecido un n√∫mero de clusters igual a 2 en las pruebas iniciales. Esto simplifica la tarea de evaluaci√≥n, ya que nos permite comparar directamente la capacidad de cada algoritmo para distinguir estos dos grupos fundamentales. 
 
De esta forma, filtramos el dataframe para incluir solo los valores que no son outliers y basamos el modelo en las columnas de inter√©s: ‚ÄòFactor_Potencia_%‚Äô y ‚ÄòDesequilibrio_Voltaje_%‚Äô. Recordemos que estas 2 variables ya est√°n estandarizadas. Posteriormente, inicializamos el algoritmo K-Means con dos clusters y centroides espec√≠ficos. Ajustamos el algoritmo K-Means al nuevo dataframe y agregamos las etiquetas de los clusters al dataframe original. En resumen, este c√≥digo realiza una agrupaci√≥n K-Means en un conjunto de datos, excluyendo los outliers (imagen 8). 
 
 ![Imagen 8](https://github.com/ggomez1803/ElectroDunas/assets/10146054/921394aa-ba3f-41df-8814-c49f6b7792bc)<br>
Imagen 8. Entrenamiento del modelo K-Means. 
 
 
Para el modelo basado en distancia o umbrales, primero filtramos el dataframe para incluir solo los valores que no son outliers, bas√°ndonos en las columnas ‚ÄòAnomalia_FP‚Äô y ‚ÄòAnomalias_Voltaje‚Äô. Luego, calculamos la matriz de covarianza inversa de las columnas ‚ÄòFactor_Potencia_%‚Äô y ‚ÄòDesequilibrio_Voltaje_%‚Äô. A continuaci√≥n, calculamos la distancia de Mahalanobis de cada punto al centroide (1, 0) y la almacenamos en una nueva columna llamada ‚ÄòDistancia‚Äô. Posteriormente, calculamos el cuantil de la distribuci√≥n chi cuadrado para un nivel de significancia de 0.01, que usamos como umbral para clasificar los puntos seg√∫n su distancia de Mahalanobis. Finalmente, los puntos cuya distancia supera la ra√≠z cuadrada del umbral se clasifican como anomal√≠as pertenecientes al cluster 1, mientras que los dem√°s se clasifican como pertenecientes al cluster 0 (imagen 9). 
 
 ![Imagen 9](https://github.com/ggomez1803/ElectroDunas/assets/10146054/5e60ae90-47c5-4582-8655-c710b9e3d187)<br>
Imagen 9. Entrenamiento del modelo basado en umbrales usando distancia de Mahalanobis. 
La distancia de Mahalanobis es preferible en situaciones donde las variables no son independientes o tienen diferentes variabilidades. A diferencia de la distancia euclidiana, que puede inflar las distancias en presencia de alta correlaci√≥n entre variables, la distancia de Mahalanobis proporciona una medida m√°s precisa al tener en cuenta estas correlaciones. Adem√°s, es invariante a las transformaciones lineales de los datos, lo que la hace robusta frente a diferencias en la escala de las variables. Este enfoque es especialmente √∫til para identificar outliers en conjuntos de datos multivariados, asegurando una detecci√≥n m√°s confiable de anomal√≠as en el consumo de energ√≠a el√©ctrica. 
 
### An√°lisis de resultados: 
#### M√©tricas de desempe√±o de los modelos: 
Para evaluar los modelos de clustering, inicialmente realizamos una comparaci√≥n entre el Silhouette Score, Davies Bouldin y Calinski Harabaz para los modelos k-Means (KM) y basados en umbrales, considerando cada cliente individualmente. Este tipo de clusterizaci√≥n nos permite definir un centroide √≥ptimo, que en este caso corresponde a un factor de potencia de 1 y un desequilibrio de 0. Basados en estos resultados, el modelo KM super√≥ a los modelos basados en umbrales, con la excepci√≥n del Silhouette Score, donde fue ligeramente inferior. 

| **Metric**              | **k-Means**        | **Clustering por umbrales**                     |
| ----------------------- | ------------------ | ----------------------------------------------- |
| Silhouette Score        | ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†0.5578 | ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†0.5625 |
| Davies-Bouldin Score    | ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†0.7273 | ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†1.3404 |
| Calinski-Harabasz Score | ¬†¬†¬†400,465.67      | ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†135,249.63       |

Tabla 1. Comparaci√≥n m√©tricas modelo K-Means y basado en umbrales. 
 
No obstante, dado que nuestro objetivo es identificar anomal√≠as, decidimos evaluar tambi√©n la densidad, el n√∫mero de datos y la varianza de cada cluster en ambos modelos. Evaluamos la densidad para entender cu√°n dispersos o compactos son los puntos dentro de cada agrupamiento. El n√∫mero de datos nos da una idea del tama√±o del cluster. En condiciones normales, el conjunto de anomal√≠as tiende a ser m√°s peque√±o, ya que las anomal√≠as no son tan frecuentes. La varianza nos proporciona una medida de cu√°nto var√≠an los puntos dentro de cada cluster. Dado que las anomal√≠as suelen ser puntos que se apartan de la norma, esperar√≠amos que el agrupamiento de anomal√≠as presente una mayor varianza. 

**Modelo K-Means**
| **m√©trica**  | **Normal**             | **Anomal√≠a**                                       |
| ------------ | ---------------------- | -------------------------------------------------- |
| Densidad     | ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†0.13 | ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†0.19 |
| N√∫mero datos | ¬†¬†¬†327,418.00          | ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†63,911.00        |
| Varianza     | ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†0.01 | ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†0.03 |

**Modelo Basado en Umbrales**
| **m√©trica**  | **Normal**             | **Anomal√≠a**                                       |
| ------------ | ---------------------- | -------------------------------------------------- |
| Densidad     | ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†0.14 | ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†0.37 |
| N√∫mero datos | ¬†¬†¬†350,937.00          | ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†40,392.00        |
| Varianza     | ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†0.01 | ¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†¬†0.08 |


Tablas 2 y 3. Comparaci√≥n m√©tricas modelo K-Means y basado en umbrales. 

Basados en los resultados de las anteriores tablas, observamos que el m√©todo basado en umbrales parece tener una mayor sensibilidad en la detecci√≥n de anomal√≠as. Este enfoque mostr√≥ el conjunto que est√° m√°s disperso (mayor densidad y varianza) y tiene menor n√∫mero de datos en comparaci√≥n con k-Means. 

Esto sugiere que cuando los clusters tienen alta varianza, las m√©tricas de Silhouette, Davies Bouldin y Calinski Harabaz podr√≠an no ser suficientes para evaluar la calidad del clustering, ya que estas m√©tricas se centran en la cohesi√≥n de los datos. Por lo tanto, es importante considerar tambi√©n otras m√©tricas que reflejen la dispersi√≥n de los datos al evaluar modelos de clustering para la detecci√≥n de anomal√≠as. 

Al visualizar la clusterizaci√≥n K-Means de la imagen 10 y comparar los clusters con el factor de potencia (FP) en el eje x y el desequilibrio de voltaje (DV) en el eje y, podemos validar nuestras hip√≥tesis. Recordemos que nuestro punto √≥ptimo, es tener una eficiencia de 1 en el FP y un desequilibrio 0 en el DV, es decir, los datos en condiciones ideales deber√≠an estar concentrados en la zona inferior derecha de la imagen 10. En esta imagen, correspondiente al Cliente 22 con K-means, que lo escogimos de ejemplo por su gran variabilidad, se observa un cluster (amarillo) de anomal√≠as claramente definido, donde se consideran anomal√≠as los valores con un factor de potencia (FP) inferior a 0.65 aproximadamente. Sin embargo, este modelo parece no considerar adecuadamente una cantidad significativa de datos que presentan anomal√≠as debido a un alto desequilibrio de voltaje (DV), los cuales se encuentran principalmente en la parte superior-derecha del gr√°fico. 

 
![Imagen 10](https://github.com/ggomez1803/ElectroDunas/assets/10146054/ee45605f-154b-4247-a53b-fe22838e6443)<br>
Imagen 10. Gr√°fico de dispersi√≥n modelo K-Means Cliente 22 

A diferencia del modelo k-means, el modelo basado en umbrales (imagen 11), que mantiene constante el centroide √≥ptimo, nos proporciona una mejor visi√≥n de los datos que se alejan m√°s de este centroide ‚Äúideal‚Äù y, por lo tanto, entre m√°s alejados est√©n tienen una mayor probabilidad de ser anomal√≠as. Este modelo utiliza la distancia de Mahalanobis como medida de distancia, la cual, a diferencia de la distancia euclidiana, tiene en cuenta la correlaci√≥n entre las variables aleatorias. Por lo tanto, para nuestro modelo, fundamentados en los resultados, decidimos optar por los modelos de clusterizaci√≥n basado en umbrales, dado que consideramos identifican de una mejor manera las anomal√≠as. 

 ![Imagen 11](https://github.com/ggomez1803/ElectroDunas/assets/10146054/78208824-7a00-4e54-bbc2-5fca37a46967)<br>
Imagen 11. Gr√°fico de dispersi√≥n modelo basado en umbrales Cliente 22 

### Plan de implementaci√≥n del prototipo: 
Como plan de implementaci√≥n del prototipo se propone la siguiente infraestructura: 

 ![Imagen 12](https://github.com/ggomez1803/ElectroDunas/assets/10146054/597d6864-b197-4af5-a0fc-60c750eccb18)<br>

A partir de un repositorio de SharePoint se podr√°n cargar los archivos de entrada con los consumos de los diferentes clientes, posteriormente desde un script de Python se leer√°n y procesar√°n los archivos para luego correr el modelo de segmentaci√≥n para cada cliente, consolidar la informaci√≥n de los consumos y exportar los datos a otro archivo .csv. Este √∫ltimo archivo .csv ser√° el insumo para poder realizar las gr√°ficas de detecci√≥n de anomal√≠as por cliente. 

Ahora bien, para facilitar la operabilidad del reporte, se han creado varios scripts de Python que est√°n interconectados entre ellos de la siguiente forma: 

 ![Imagen 13](https://github.com/ggomez1803/ElectroDunas/assets/10146054/56b1c53e-32bb-42a5-8574-e87185e54cd2)<br>

Imagen 13. Estructura de scripts de Python 

Donde en rutas.py se diligencian las rutas de lectura y de exportaci√≥n de los archivos que se van a trabajar, mientras que en Funciones_Procesamiento.py y Funciones_Cluster.py se encuentran todas las acciones que se realizan a los datos de entrada y donde se cargan los modelos de cluster ya entrenados para poder predecir nuevos datos en el futuro. 
